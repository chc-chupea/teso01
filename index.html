<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>âœ¨åˆã‚³ãƒ³æ‰‹ç›¸è¨ºæ–­âœ¨</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.12.0/dist/tf.min.js"></script>
  <script async src="https://docs.opencv.org/4.x/opencv.js"></script>
  <style>
    body {
      font-family: 'Noto Sans JP', sans-serif;
      background-color: #fff0f5;
      text-align: center;
      color: #333;
      padding: 10px;
      max-width: 480px;
      margin: auto;
    }
    .button {
      background-color: #ff69b4;
      color: #fff;
      padding: 12px 20px;
      border-radius: 25px;
      margin: 15px 10px;
      cursor: pointer;
      font-size: 1.1em;
      border: none;
      transition: background-color 0.3s ease;
    }
    .button[disabled] {
      background-color: #ccc;
      cursor: not-allowed;
    }
  </style>
</head>
<body>
  <h2>ğŸ“· åˆã‚³ãƒ³ æ‰‹ã®ã²ã‚‰ã‚¹ãƒãƒ›è¨ºæ–­ âœ¨</h2>
  <label for="handSelect">ğŸ“Œ æ‰‹ã®é¸æŠï¼š</label>
  <select id="handSelect">
    <option value="">-- å·¦å³ã®æ‰‹ã‚’é¸ã‚“ã§ã­ --</option>
    <option value="Left">å·¦æ‰‹ï¼ˆç´ è³ªï¼‰</option>
    <option value="Right">å³æ‰‹ï¼ˆåŠªåŠ›ãƒ»ä»Šï¼‰</option>
  </select>
  <br>
  <label for="genreSelect">ğŸ“Œ ã‚¸ãƒ£ãƒ³ãƒ«é¸æŠï¼š</label>
  <select id="genreSelect">
    <option value="">-- ã‚¸ãƒ£ãƒ³ãƒ«ã‚’é¸ã‚“ã§ã­ --</option>
    <option value="love">æ‹æ„›</option>
    <option value="work">ä»•äº‹</option>
    <option value="money">é‡‘é‹</option>
    <option value="health">å¥åº·</option>
    <option value="personality">æ€§æ ¼</option>
    <option value="all">å…¨éƒ¨è¨ºæ–­</option>
  </select>
  <br>
  <video id="video" autoplay playsinline></video>
  <canvas id="output" width="640" height="480" style="display:none;"></canvas>
  <br>
  <button id="captureButton" class="button" disabled>ğŸ“· æ’®å½±ï¼‹è¨ºæ–­ï¼</button>
  <div id="result" style="white-space: pre-wrap; margin-top: 1em; background: #fff; border: 1px dashed #ff69b4; padding: 1em; border-radius: 10px;">ğŸ‘‰ çµæœãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™ âœ¨</div>

  <script>
    let palmistryComments = {};
    const captureButton = document.getElementById('captureButton');

    // JSONãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿
    fetch('./comments.json')
      .then(response => {
        if (!response.ok) throw new Error('èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼');
        return response.json();
      })
      .then(data => {
        palmistryComments = data;
        captureButton.disabled = false;
        console.log('âœ… ã‚³ãƒ¡ãƒ³ãƒˆJSONèª­ã¿è¾¼ã¿å®Œäº†');
      })
      .catch(err => {
        alert('ã‚³ãƒ¡ãƒ³ãƒˆãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚');
        console.error(err);
      });

    // Utilityé–¢æ•°
    function getSoshiOrGenzaiLabel(hand) {
      return hand === 'Left' ? 'ï¼ˆç”Ÿã¾ã‚ŒæŒã£ãŸç´ è³ªï¼‰' : 'ï¼ˆä»Šã®åŠªåŠ›ã‚„ç’°å¢ƒï¼‰';
    }

    function getResultComment(hand, genre, level) {
      const base = palmistryComments[genre] || [];
      return base[level] + `\nï¼ˆ${hand === 'Left' ? 'ç´ è³ªè¨ºæ–­' : 'ç¾åœ¨ã®çŠ¶æ…‹è¨ºæ–­'}ï¼‰`;
    }

    function getFinalResultText(hand, genre, level, comment, extraInfo = '') {
      return `âœ¨ ${hand} æ‰‹${getSoshiOrGenzaiLabel(hand)}ã®è¨ºæ–­ âœ¨\n\n` +
             `ğŸ’– ã‚¸ãƒ£ãƒ³ãƒ«: ${genre}\nğŸ”¢ ãƒ¬ãƒ™ãƒ«: ${level + 1}/50\nğŸ’¬ ã‚³ãƒ¡ãƒ³ãƒˆ: ${comment}\n${extraInfo}`;
    }

    // æ‰‹ç›¸è¨ºæ–­å‡¦ç†ï¼ˆç°¡ç•¥ç‰ˆï¼‰
    captureButton.addEventListener('click', () => {
      const hand = document.getElementById('handSelect').value;
      const genre = document.getElementById('genreSelect').value;
      if (!hand || !genre) {
        alert("ğŸ‘‰ ã¾ãšã¯ã€å·¦å³ã®æ‰‹ã€ã¨ã€ã‚¸ãƒ£ãƒ³ãƒ«ã€ã‚’é¸ã‚“ã§ã­ï¼");
        return;
      }
      const level = Math.floor(Math.random() * 50);
      const comment = getResultComment(hand, genre, level);
      const resultText = getFinalResultText(hand, genre, level, comment);
      document.getElementById('result').textContent = resultText;
    });
  </script>
</body>
</html>
